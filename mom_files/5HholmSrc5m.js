/*!CK:1809531165!*//*1427208055,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["P96yp"]); }

__d("ChatMiniSidebarUser.react",["AvailableListConstants","ChatOpenTab","Image.react","Link.react","WebMessengerPermalinkConstants","ReactComponentWithPureRenderMixin","React","ReactLayeredComponentMixin","Tooltip","XUIAmbientNUX.react","cx","emptyFunction","ix","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();'use strict';var u=m,v=u.PropTypes,w=m.createClass({displayName:"ChatMiniSidebarUser",mixins:[l,n],propTypes:{context:v.string,detailedStatus:v.string,expanding:v.bool.isRequired,id:v.string.isRequired,isHighlighted:v.bool,isOffline:v.bool.isRequired,name:v.string.isRequired,onMouseLeave:v.func,onMouseOver:v.func,onNUXSeen:v.func,onOpenTab:v.func,section:v.string.isRequired,shouldShowNUX:v.bool,status:v.number.isRequired,statusTime:v.string,thumbSrc:v.string.isRequired},getDefaultProps:function(){return {onMouseLeave:r,onMouseOver:r,onNUXSeen:r};},_openTab:function(){h.openUserTab(this.props.id,this.props.section);this.props.onOpenTab&&this.props.onOpenTab();},_onClick:function(x){this._openTab();x.preventDefault();},_renderImage:function(){return m.createElement(i,{src:this.props.thumbSrc,alt:""});},_renderName:function(){if(!this.props.expanding)return null;return (m.createElement("div",{className:"_4rqx"},this.props.name));},_renderContext:function(){return (m.createElement("div",{className:"_4rqx _1hml"},this.props.context));},_renderStatus:function(){var x=null;if(this.props.status==g.ACTIVE){x=s('/images/litestand_classic/sidebar/online.png');}else if(this.props.status==g.MOBILE)x=s('/images/litestand_classic/sidebar/pushable.png');var y=x?m.createElement(i,{className:"_d9q",src:x}):null;return (m.createElement("div",{className:"_2sb6"},m.createElement("div",{className:"_d9r"},this.props.expanding?this.props.detailedStatus:null),m.createElement("div",{className:"_d9s"},this.props.expanding?this.props.statusTime:null),y));},_getHref:function(){return k.getURIPathForIDOrVanity(this.props.id);},renderLayers:function(){return {nux:(m.createElement(p,{alignment:"left",contextRef:"user",customwidth:234,position:"left",onCloseButtonClick:this.props.onNUXSeen,shown:this.props.shouldShowNUX,width:"custom"},t._("New! A chat sidebar for smaller screens. Click a photo to chat or hover to expand.")))};},render:function(){return (m.createElement("li",{className:(("_2sb2")+(this.props.isOffline?' '+"_3maz":'')+(this.props.isHighlighted?' '+"_5aw":'')),onMouseLeave:this.props.onMouseLeave,onMouseOver:this.props.onMouseOver,ref:"user"},m.createElement(j,{className:"_2sb3",href:{url:this._getHref()},onClick:this._onClick,rel:"ignore"},m.createElement("div",{className:(("_2sb4")+(this.props.context?' '+"_1hmm":''))},m.createElement("div",m.__spread({},o.propsFor(this.props.expanding?'':this.props.name),{className:"_2sb5","data-tooltip-position":"left"}),this._renderImage()),this._renderName(),this._renderContext(),this._renderStatus()))));}});e.exports=w;},null);
__d("ChatMiniSidebarBody.react",["AsyncRequest","ChatConfig","ChatMiniSidebarUser.react","ChatMiniSidebarUserMixin","ChatSidebarSections","React","ScrollableArea.react","ShortProfiles","XUISpinner.react","XChatMiniSidebarNUXSeenController","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();'use strict';var s=l,t=s.PropTypes,u=l.createClass({displayName:"ChatMiniSidebarBody",mixins:[j],propTypes:{height:t.number.isRequired,expanding:t.bool,onMouseLeave:t.func,onMouseOver:t.func,onScroll:t.func,onOpenTab:t.func,users:t.array.isRequired},getDefaultProps:function(){return {expanding:false,onMouseLeave:r,onMouseOver:r,onScroll:r};},getInitialState:function(){return {loading:true,userData:[],showNUX:h.get('www_mini_sidebar_nux')&&!h.get('seen_mini_sidebar_nux')};},componentDidMount:function(){this._populateUserData(this.props.users);},componentWillReceiveProps:function(v){this._populateUserData(v.users);if(v.expanding!==this.props.expanding&&!h.get('seen_mini_sidebar_nux'))this._onNUXSeen();},_populateUserData:function(v){n.getMulti(v,function(w){var x=v.map(function(y){return w[y];});this.setState({loading:false,userData:x});}.bind(this));},_onNUXSeen:function(){this.setState({showNUX:false});h.set('seen_mini_sidebar_nux',true);var v=p.getURIBuilder().getURI();new g(v).send();},_renderUser:function(v,w){if(v.id=='0'||!v.is_friend)return null;var x=this.getStatus(v.id);return (l.createElement(i,{detailedStatus:x.detailedStatus,expanding:this.props.expanding,id:v.id,isOffline:x.offline,key:v.id,name:v.name,onMouseLeave:this.props.onMouseLeave,onMouseOver:this.props.onMouseOver,onNUXSeen:this._onNUXSeen,onOpenTab:this.props.onOpenTab,section:k.ORDERED_LIST,shouldShowNUX:w===0&&this.state.showNUX,status:x.status,statusTime:x.statusTime,thumbSrc:v.thumbSrc}));},render:function(){var v=null;if(this.state.loading){v=l.createElement("div",{className:"_1rg3"},l.createElement(o,null));}else v=l.createElement("ul",null,this.state.userData.map(function(w,x){return this._renderUser(w,x);}.bind(this)));return (l.createElement(m,{height:this.props.height,fade:true,onScroll:this.props.onScroll,persistent:true,shadow:false},v));}});e.exports=u;},null);
__d("ChatMiniSidebarFooter.react",["ChatConfig","ChatSidebarDropdown.react","ChatSidebarComposeLink.react","React","SearchableTextInput.react","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();'use strict';var o=j,p=o.PropTypes,q=g.get('mini_sidebar_hide_gear',false),r=j.createClass({displayName:"ChatMiniSidebarFooter",propTypes:{expanding:p.bool.isRequired,onClickPause:p.func.isRequired,onClickSearch:p.func.isRequired,onEntriesFound:p.func.isRequired,onInputChanged:p.func.isRequired,onKeyDown:p.func.isRequired,onMenuHide:p.func,onMenuShow:p.func,onQueryFinished:p.func,onToggleSidebar:p.func.isRequired,source:p.object.isRequired},getDefaultProps:function(){return {onQueryFinished:m};},getInitialState:function(){return {query:''};},componentWillReceiveProps:function(s){if(s.expanding!==this.props.expanding)this.setState({query:''});},componentDidUpdate:function(s,t){if(!s.expanding&&this.props.expanding&&this.refs.searchInput){setTimeout(this.refs.searchInput.focusInput,0);this.props.source.refreshData();}},_onClickSearch:function(s){s.preventDefault();this.props.onClickSearch(true,this.state.query);},_onChange:function(s){var t=s.target.value;this.setState({query:t});this.props.onInputChanged(t);},_onMenuHide:function(){if(!q)return;this.props.onMenuHide&&this.props.onMenuHide();},_onMenuShow:function(){if(!q)return;this.props.onMenuShow&&this.props.onMenuShow();},_onQueryFinished:function(s){s===this.state.query&&this.props.onQueryFinished();},_renderSearchInput:function(){if(!this.props.expanding)return null;return (j.createElement("div",{className:"_3f-7"},j.createElement(k,{onChange:this._onChange,onEntriesFound:this.props.onEntriesFound,onKeyDown:this.props.onKeyDown,placeholder:n._("Search"),queryString:this.state.query,ref:"searchInput",searchSource:this.props.source,searchSourceOptions:{onQueryFinished:this._onQueryFinished}})));},_renderComposeLink:function(){return (j.createElement(i,{className:"_3a-4 _3a-5"}));},_renderDropdown:function(){if(q&&!this.props.expanding)return null;return (j.createElement(h,{className:"_43p4",isNormalSidebar:false,onClickPause:this.props.onClickPause,onHide:this._onMenuHide,onShow:this._onMenuShow,onToggleSidebar:this.props.onToggleSidebar}));},render:function(){return (j.createElement("div",{className:(("_iup")+(q?' '+"_1f7n":'')),ref:"search"},j.createElement("div",{"aria-label":n._("Search"),className:"_35_4 _43p3","data-hover":"tooltip",onClick:this._onClickSearch,ref:"icon"}),this._renderSearchInput(),this._renderDropdown(),this._renderComposeLink()));}});e.exports=r;},null);
__d("ChatMiniSidebarSearchView.react",["ChatMiniSidebarThread.react","ChatMiniSidebarUser.react","ChatMiniSidebarUserMixin","ChatSidebarSections","ChatTypeaheadConstants","CurrentUser","MercuryIDs","PresenceStatus","React","MercuryThreadMetadataRawRenderer","XUISpinner.react","arrayContains","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=o,v=u.PropTypes,w=k.FRIEND_TYPE,x=k.THREAD_TYPE,y=k.FB4C_TYPE,z=k.PAGE_TYPE,aa=k.NON_FRIEND_TYPE,ba=o.createClass({displayName:"ChatMiniSidebarSearchView",mixins:[i],propTypes:{entries:v.arrayOf(v.object).isRequired,highlightID:v.string,onOpenTab:v.func,queryFinished:v.bool},_checkThread:function(ca){var da='fbid:'+l.getID();if(!r(ca.participants,da))return false;return true;},_renderThread:function(ca,da){var ea=ca.getUniqueID(),fa=ca.getAuxiliaryData();if(!fa)return null;var ga=fa.thread;if(!ga||!this._checkThread(ga))return null;var ha=fa.participantsToRender,ia=ga.participants.length-1,ja=this._renderThreadName(ea,ha,ia),ka=n.getGroup(ga.participants.map(function(la){return m.getUserIDFromParticipantID(la);}));return (o.createElement(g,{context:ja,id:ea,isHighlighted:ea===this.props.highlightID,key:ea,threadName:ga.name,onOpenTab:this.props.onOpenTab,participants:fa.participantsToRender,status:ka,thumbSrc:ca.getPhoto()}));},_renderThreadName:function(ca,da,ea){return p.renderRawParticipantList(ca,da,ea,{names_renderer:p.renderShortNames});},_renderUser:function(ca,da){var ea=ca.getUniqueID();if(ea=='0')return null;var fa=this.getStatus(ea),ga=ca.getType(),ha=ga===y||ga===aa||ga===z?ca.getSubtitle():null;return (o.createElement(h,{context:ha,detailedStatus:fa.detailedStatus,expanding:true,id:ea,isHighlighted:ea===this.props.highlightID,isOffline:fa.offline,key:ea,name:ca.getTitle(),onOpenTab:this.props.onOpenTab,section:j.TYPEAHEAD,status:fa.status,statusTime:fa.statusTime,thumbSrc:ca.getPhoto()}));},_renderHeader:function(ca){return (o.createElement("div",{key:ca,className:"_5tmy"},o.createElement("div",{className:"_5tn8"},ca)));},_renderSection:function(ca,da){var ea=this.props.entries.filter(function(ga){return ga.getType()===ca;}).reverse(),fa=ca===x?this._renderThread:this._renderUser;return ea.length>0?[this._renderHeader(da)].concat(ea.map(fa)):[];},render:function(){var ca=null,da="_9y8";if(this.props.entries.length===0){if(this.props.queryFinished){ca=t._("No results.");}else{ca=o.createElement(q,null);da="_9y8 _1rg3";}}else ca=this._renderSection(aa,t._("MORE PEOPLE")).concat(this._renderSection(z,t._("PAGES"))).concat(this._renderSection(x,t._("GROUP CONVERSATIONS"))).concat(this._renderSection(y,t._("CO-WORKERS"))).concat(this._renderSection(w,t._("FRIENDS")));return (o.createElement("div",{className:da},ca));}});e.exports=ba;},null);
__d("ChatMiniSidebar.react",["AvailableList","AvailableListConstants","ChannelConnection","ChatOrderedList","ChatSidebarConstants","ChatSortUsers","ChatMiniSidebarBody.react","ChatMiniSidebarFooter.react","ChatMiniSidebarSearchView.react","ChatOpenTab","ChatSidebarSections","ChatTypeaheadConstants","Event","Keys","PresencePrivacy","React","SubscriptionsHandler","createObjectFrom","cx","emptyFunction","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();'use strict';var ba=v,ca=ba.PropTypes,da=6,ea=27,fa=v.createClass({displayName:"ChatMiniSidebar",propTypes:{dataSource:ca.object.isRequired,height:ca.number.isRequired,maxEntries:ca.number,onClickSearch:ca.func.isRequired,onToggleSidebar:ca.func,shown:ca.bool},getDefaultProps:function(){return {maxEntries:0,onToggleSidebar:z,shown:false};},getInitialState:function(){return {currentQueryFinished:false,canExpand:true,canShrink:true,expanding:false,highlightIndex:0,inside:false,isSearching:false,pauseRendering:false,searchResults:[],users:[]};},componentWillMount:function(){this._subscriptions=new w();this._subscriptions.addSubscriptions(g.subscribe(h.ON_AVAILABILITY_CHANGED,this._updateUsers),i.subscribe([i.CONNECTED,i.RECONNECTING,i.SHUTDOWN,i.MUTE_WARNING,i.UNMUTE_WARNING],aa(this.forceUpdate,this)),u.subscribe('privacy-changed',aa(this.forceUpdate,this)),u.subscribe('privacy-user-presence-changed',this._updateUsers));this._updateUsers();},componentWillReceiveProps:function(ga){if(ga.shown!==this.props.shown)this.setState({currentQueryFinished:false,expanding:false,isSearching:false,searchResults:[]});},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},_getScrollableAreaHeight:function(){return Math.max(this.props.height-da-ea,0);},_updateUsers:function(){if(!this.props.shown||this.state.pauseRendering)return;var ga=this._getScrollableAreaHeight(),ha=ga/k.getItemHeight(true),ia=j.getSortedList({},ha),ja=j.getAvailableList(x(ia));ja.sort(l.sortMobile);this.setState({users:ia.concat(ja)});},_onClickSearch:function(ga,ha){this.props.onClickSearch(ga);this.setState({currentQueryFinished:false,expanding:ga,isSearching:!!ha,highlightIndex:0});},_onEntriesFound:function(ga){this.setState({highlightIndex:0,searchResults:ga});},_onInputChanged:function(ga){var ha=!!ga;this.setState({currentQueryFinished:false,isSearching:ha});},_onClickPause:function(ga){this.setState({pauseRendering:ga});},_onMouseEnterSidebar:function(){this.setState({inside:true});clearTimeout(this._mouseLeaveCallback);clearTimeout(this._mouseOverCallback);},_onMenuHide:function(){!this.state.canShrink&&this.setState({canShrink:true});!this.state.inside&&this._onMouseLeaveSidebar();},_onMenuShow:function(){this.state.canShrink&&this.setState({canShrink:false});},_onMouseLeaveSidebar:function(){this.setState({inside:false});clearTimeout(this._mouseOverCallback);if(!this.state.expanding)return;clearTimeout(this._mouseLeaveCallback);this._mouseLeaveCallback=setTimeout(function(){(this.state.expanding&&this.state.canShrink)&&this._onClickSearch(false,'');}.bind(this),300);},_onMouseLeaveUser:function(){clearTimeout(this._mouseOverCallback);!this.state.canExpand&&this.setState({canExpand:true});},_onMouseOverUser:function(){clearTimeout(this._mouseLeaveCallback);if(this.state.expanding)return;clearTimeout(this._mouseOverCallback);this._mouseOverCallback=setTimeout(function(){(!this.state.expanding&&this.state.canExpand)&&this._onClickSearch(true,'');}.bind(this),500);},_onOpenTab:function(){this.setState({canExpand:false});this._onClickSearch(false,'');},_changeHighlight:function(ga){var ha=this.state.searchResults.length,ia=ha===0?0:(this.state.highlightIndex+ga)%ha;return ia>=0?ia:ha-1;},_onKeyDown:function(ga){var ha=s.getKeyCode(ga),ia=true;switch(ha){case t.UP:this.setState({highlightIndex:this._changeHighlight(1)});break;case t.DOWN:this.setState({highlightIndex:this._changeHighlight(-1)});break;case t.RETURN:var ja=this.state.searchResults[this.state.highlightIndex];if(ja){var ka=ja.getUniqueID(),la=ja.getType()===r.THREAD_TYPE?p.openThread:p.openUserTab;la(ka,q.TYPEAHEAD);this._onOpenTab();}break;default:ia=false;}ia&&ga.preventDefault();},_onQueryFinished:function(){this.setState({currentQueryFinished:true});},render:function(){if(!this.props.shown)return null;var ga=this._getScrollableAreaHeight(),ha=this.state.searchResults[this.state.highlightIndex],ia=ha?ha.getUniqueID():null,ja=this.state.isSearching?v.createElement(o,{entries:this.state.searchResults.slice(0,this.props.maxEntries),highlightID:ia,onOpenTab:this._onOpenTab,queryFinished:this.state.currentQueryFinished}):v.createElement(m,{className:"_269x",height:ga,expanding:this.state.expanding,onMouseLeave:this._onMouseLeaveUser,onMouseOver:this._onMouseOverUser,onScroll:function(){return clearTimeout(this._mouseOverCallback);}.bind(this),onOpenTab:this._onOpenTab,users:this.state.users});return (v.createElement("div",{className:"_269v",onMouseEnter:this._onMouseEnterSidebar,onMouseLeave:this._onMouseLeaveSidebar,style:{height:this.props.height}},v.createElement("div",{className:"_269w"}),ja,v.createElement(n,{expanding:this.state.expanding,onClickPause:this._onClickPause,onClickSearch:this._onClickSearch,onEntriesFound:this._onEntriesFound,onInputChanged:this._onInputChanged,onKeyDown:this._onKeyDown,onMenuHide:this._onMenuHide,onMenuShow:this._onMenuShow,onQueryFinished:this._onQueryFinished,onToggleSidebar:this.props.onToggleSidebar,source:this.props.dataSource})));}});e.exports=fa;},null);